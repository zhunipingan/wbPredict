{% extends "base.html" %}
{% load staticfiles %}
    {% block context %}
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Bread crumb and right sidebar toggle图标上面的一行空白 -->
                <!-- ============================================================== -->
                <div class="row page-titles">

                </div>
                <!-- ============================================================== -->
                <!-- End Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <!-- Row -->
                <!--<div class="col-lg-8 col-xlg-9 col-md-7">
                        <div class="card">

                            <div class="tab-content">
                                <div class="tab-pane active" id="home" role="tabpanel">
                                    <div class="card-block">
                                        <div class="profiletimeline">
                                            <div class="sl-item">
                                                <div class="sl-left"> <img src="../assets/images/users/1.jpg" alt="user" class="img-circle"> </div>
                                                <div class="sl-right">
                                                    <div><a href="#" class="link">John Doe</a> <span class="sl-date">5 minutes ago</span>
                                                        <p>assign a new task <a href="#"> Design weblayout</a></p>
                                                        <div class="row">
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img1.jpg" alt="user" class="img-responsive radius"></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img2.jpg" alt="user" class="img-responsive radius"></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img3.jpg" alt="user" class="img-responsive radius"></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img4.jpg" alt="user" class="img-responsive radius"></div>
                                                        </div>
                                                        <div class="like-comm"> <a href="javascript:void(0)" class="link m-r-10">2 comment</a> <a href="javascript:void(0)" class="link m-r-10"><i class="fa fa-heart text-danger"></i> 5 Love</a> </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>-->
                <!--kaishi-->
                <div class="row">
                    <div class="col-lg-8 col-xlg-9 col-md-7">
                    <!-- Column第一个图标 -->
                        <div class="card">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs profile-tab" role="tablist">
                                <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#home" role="tab">博文信息</a> </li>
                                <!--<li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#profile" role="tab">Profile</a> </li>
                                <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#settings" role="tab">Settings</a> </li>-->
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane active" id="home" role="tabpanel">
                                    <div class="card-block">
                                        <div class="profiletimeline">
                                                <div class="sl-item">
                                                    <div class="sl-left"> <img src="{{weibo.portrait}}" alt="user" class="img-circle"> </div>
                                                    <div class="sl-right">
                                                        <div><a  href="{{user_info.get_absolute_url}}" target="_parent" title="点击前往博主主页">{{weibo.nick_name}}</a> <span class="sl-date">{{weibo.created_at}}</span>
                                                            <p>{{weibo.content}}</p>
                                                            <div class="row">
                                                                {% for pic in weibo.pic_url %}
                                                                    <div class="col-lg-3 col-md-6 m-b-20"><img src="{{pic}}" alt="user" class="img-responsive radius" onclick="imgZoomIn(this.src);"></div>
                                                                {% endfor %}

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <!-- Column第一个图标 -->
                        <div class="card">
                            <div class="card-block">
                                <div class="col-12">
                                <div id="container_like" style="height: 360px;"></div>
                            </div>
                            </div>
                         </div>
                    <!-- Column第一个图标 -->
                        <div class="card">
                            <div class="card-block">
                                <div class="col-12">
                                <div id="container_comment" style="height: 360px;"></div>
                                </div>
                            </div>
                         </div>

                    <!-- Column第一个图标 -->

                        <div class="card">
                            <div class="card-block">
                                <div class="col-12">
                                <div id="container_forward" style="height: 360px;"></div>
                            </div>
                            </div>
                         </div>

                    <!-- Column第一个图标 -->
                        <div class="card">
                            <div class="card-block">
                                <div class="col-12">
                                    <h4 class="font-medium m-t-30">当前互动数</h4>
                                        <hr>
                                        {% for info in pie2%}
                                        <h5 class="m-t-30">{{info.name}}<span class="pull-right">{{info.value}} (占比{{info.percent}}%)</span></h5>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:{{info.percent}}%; height:6px;"> <span class="sr-only">50% Complete</span> </div>
                                        </div>
                                        {% endfor %}
                            </div>
                            </div>
                         </div>


                    <!-- Column第一个图标 -->
                        {% if word_cloud|length > 0 %}
                        <div class="card">
                            <div class="card-block">
                                <div class="col-12">
                                <div id="main" style="height: 360px;"></div>
                            </div>
                            </div>
                         </div>
                        {% endif%}
                    <!-- 第二个图标-->
                     </div>
                    <div class="col-lg-4 col-xlg-3 col-md-5">
                        <!-- Column -->
                        <!--<div class="card" hidden="true">-->
                            <!--<img class="card-img-top" src="{% static 'index/assets/images/background/profile-bg.jpg' %}" alt="Card image cap">-->
                            <!--<div class="card-block little-profile text-center"  style="height: 236px;">-->
                                <!--<div class="pro-img"><img src="{{user_info.portrait}}" alt="user" /></div>-->
                                <!--<h3 class="m-b-0">{{user_info.nick_name}}</h3>-->
                                <!--<p>{{user_info.brief_introduction}}</p>-->
                                <!--<a href="{{user_info.get_absolute_url}}" target="_parent">查看博主主页</a>-->

                                <!--&lt;!&ndash;<a href="javascript:void(0)" class="m-t-10 waves-effect waves-dark btn btn-primary btn-md btn-rounded">Follow</a>&ndash;&gt;-->
                            <!--</div>-->
                        <!--</div>-->
                         <div class="card">
                             <div class="card-block bg-info">
                                <h4 class="text-white card-title">情感指数</h4>
                            </div>
                            <div class="card-block">
                                <div class="col-12">
                                <div id="container" style="height: 250px;"></div>
                            </div>
                            </div>
                         </div>
                        <div class="card">
                            <div class="card-block bg-info">
                                <h4 class="text-white card-title">关键词信息</h4>
                            </div>
                            <div class="card-block">
                                <div class="message-box contact-box">
                                    <div style="overflow-y:scroll;height: 285px;" class="message-widget contact-widget">
                                        <!-- Message -->
                                        {% if weibo.key|length > 0 %}
                                        下面是博文对应的关键词及权重信息<br><br>

                                        {% for key_word in weibo.key %}
                                        <b>{{key_word.0}}</b> : {{key_word.1}}<br>
                                        {% endfor %}
                                        {% else %}
                                            <p class="m-t-10"> 暂时没有发掘关键词~ </p>
                                        {% endif %}
                                        <!-- Message -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-block bg-info">
                                <h4 class="text-white card-title">热门评论</h4>
                            </div>
                            <div class="card-block">
                                <div class="message-box contact-box">
                                    <div style="overflow-y:scroll;height: 285px;" class="message-widget contact-widget">
                                        <!-- Message -->
                                        {% for comment in hot_comment %}
                                            <div class="mail-contnet">
                                                <h5>{{comment.content}}</h5>
                                            </div>
                                        <div  style="font-size:10px" align="right" class="mail-desc">用户{{comment.comment_user_id}} 发表于{{comment.created_at}}</div>
                                        <hr>
                                        {% empty %}
                                            <p class="m-t-10"> 暂时没有发现评论~ </p>
                                        {% endfor %}
                                        <!-- Message -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-block bg-info">
                                <h4 class="text-white card-title">博主其他微博</h4>
                            </div>
                            <div class="card-block">
                                <div class="message-box contact-box">
                                    <div style="overflow-y:scroll;height: 615px;" class="message-widget contact-widget">
                                        <!-- Message -->
                                        {% for weibo in weibo_list %}
                                            <div class="mail-contnet">
                                                <a href = "{{ weibo.get_absolute_url }}" title="点击前往查看微博数据分析" target="_parent">
                                                <h5>{{weibo.content}}</h5>
                                                </a>
                                            </div>
                                         <div class="like-comm"> {{weibo.repost_num}} 转发  {{weibo.like_num}} 点赞  {{weibo.comment_num}} 评论</div>
                                        <div  style="font-size:10px" align="right" class="mail-desc">发表于{{weibo.created_at}}</div>
                                        <hr>
                                        {% empty %}
                                            <p class="m-t-10"> 暂时没有发现其他微博~ </p>
                                        {% endfor %}
                                        <!-- Message -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Column -->

                    </div>
                </div>
                <!-- Row -->
                <!-- Row -->
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- End footer -->
            <!-- ============================================================== -->
<!--图片放大 模态框（Modal） -->
    <div class="modal fade text-center" id="imgZoomInModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
     <div class="modal-dialog" style="display: inline-block; width: auto;">
      <div class="modal-content">
       <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
       </div>
       <div class="modal-body">
        <img src="" id="pigImg" />
       </div>
      </div>
      <!-- /.modal-content -->
     </div>
    </div>

    {% endblock context %}

{% block javascript %}
<script type="text/javascript">
var dom = document.getElementById("container");
var myChart = echarts.init(dom);
var app = {};
option = null;
var negative_score = {{negative_score|safe}}
option = {
    tooltip : {
        formatter: "{a} <br/>{b} : {c}%",
        trigger: 'item',
        formatter : function (params) {
            //var value = (params.value + '').split('.');
            //value = value[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, '$1,')
            //        + '.' + value[1];
            var str = '偏积极(喜悦)'
            if (!params.value)
                params.value = 0
            if(params.value <= 40)
                str =  '偏积极(喜悦)'
            else if (params.value >= 60)
                str =  '偏消极(低落)'
            else
                str =  '偏中性'

            return '情感倾向' + '：'+str+'<br/>' + '积极概率' +(100-params.value).toFixed(2)+ '%   消极概率'+params.value+'%';
        }
    },
    series: [
        {
            name: '博文情感',
            radius: '100%',
            type: 'gauge',
            detail: {formatter:function (params) {
            var str = '偏积极(喜悦)'
            if (!params)
                params = 0
            if(params <= 40)
                str =  '偏积极(喜悦)'
            else if (params >= 60)
                str =  '偏消极(低落)'
            else
                str =  '偏中性'

            return str;
        },
        textStyle: {
                    fontSize: 15
                },},
            axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color:[[0.4, '#91c7ae'], [0.6, '#63869e'], [1, '#c23531']]
                    }
            },
            data: [{value: negative_score, name: '情感倾向'}]
        }
    ]
};
;
if (option && typeof option === "object") {
    myChart.setOption(option, true);
}


var dom = document.getElementById("container_like");
var myChart = echarts.init(dom);//user_info
var app = {};
var list = {{list|safe}}
option = null;
option = {
    title: {
        text: '点赞数变化'
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        data:['点赞数']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis: {
        type: 'category',
        boundaryGap: false,
        data: list.date//['周一','周二','周三','周四','周五','周六','周日']
    },
    yAxis: {
        type: 'value'
    },
    series: [
        {
            name:'点赞数',
            type:'line',
            stack: '总量',
            data:list.like//[120, 132, 101, 134, 90, 230, 210]
        }
    ]
};
;
if (option && typeof option === "object") {
    myChart.setOption(option, true);
}
//container comment
var dom = document.getElementById("container_comment");
var lineChart2 = echarts.init(dom);
var app = {};
var list = {{list|safe}}
option = null;
option = {
    title: {
        text: '评论数变化'
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        data:['评论数']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis: {
        type: 'category',
        boundaryGap: false,
        data: list.date//['周一','周二','周三','周四','周五','周六','周日']
    },
    yAxis: {
        type: 'value'
    },
    series: [
        {
            name:'评论数',
            type:'line',
            stack: '总量',
            data:list.comment//[220, 182, 191, 234, 290, 330, 310]
        }
    ]
};
;
if (option && typeof option === "object") {
    lineChart2.setOption(option, true);
}
//container forward
var dom = document.getElementById("container_forward");
var lineChart2 = echarts.init(dom);
var app = {};
var list = {{list|safe}}
option = null;
option = {
    title: {
        text: '转发数变化'
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        data:['转发数']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis: {
        type: 'category',
        boundaryGap: false,
        data: list.date//['周一','周二','周三','周四','周五','周六','周日']
    },
    yAxis: {
        type: 'value'
    },
    series: [
        {
            name:'转发数',
            type:'line',
            stack: '总量',
            data:list.forward//[150, 232, 201, 154, 190, 330, 410]
        }
    ]
};
;
if (option && typeof option === "object") {
    lineChart2.setOption(option, true);
}


//词云

var word_cloud = {{word_cloud|safe}}
var chart = echarts.init(document.getElementById('main'));
            var option = {
                title: {
                    text: '评论词信息'
                },
                tooltip: {},
                series: [ {
                    type: 'wordCloud',
                    //gridSize: 0,
                    sizeRange: [12, 70],
                    rotationRange: [-90, 90],
                    width: 600,
                    height: 400,
                    drawOutOfBound: true,
                    textStyle: {
                        normal: {
                            color: function () {
                                return 'rgb(' + [
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160)
                                ].join(',') + ')';
                            }
                        },
                        emphasis: {
                            shadowBlur: 10,
                            shadowColor: '#333'
                        }
                    },
                    data:word_cloud

                } ]
            };
            chart.setOption(option);
            window.onresize = chart.resize;
//点击查看原图
	function imgZoomIn(src){
		$("#pigImg").attr('src',src.replace('wap180','bmiddle'));
    	$("#imgZoomInModal").modal("show");
	}
       </script>
{% endblock javascript %}